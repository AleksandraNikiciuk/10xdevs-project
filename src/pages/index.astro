---
import Layout from "../layouts/Layout.astro";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "../components/ui/card";
import { Zap, List, PenSquare } from "lucide-react";
import { ThemeToggle } from "../components/ui/theme-toggle";

const navItems = [
  {
    href: "/generate",
    title: "Generate with AI",
    description: "Automatically create flashcards from your text using AI.",
    icon: Zap,
  },
  {
    href: "/flashcards",
    title: "Browse Flashcards",
    description: "View, edit, and manage all your created flashcards.",
    icon: List,
  },
  {
    href: "/manual-create",
    title: "Create Manually",
    description: "Add new flashcards one by one with your own content.",
    icon: PenSquare,
  },
];
---

<Layout title="Dashboard">
  <main class="container mx-auto px-4 py-8">
    <header class="flex justify-between items-center mb-12">
      <div class="flex-1"></div>
      <div class="flex-1 text-center">
        <h1 class="text-4xl font-bold tracking-tight">Flashcard Dashboard</h1>
        <p class="text-lg text-muted-foreground mt-2">Choose an option to get started</p>
      </div>
      <div class="flex-1 flex justify-end">
        <ThemeToggle client:load />
      </div>
    </header>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {
        navItems.map((item) => (
          <a href={item.href} class="block hover:scale-105 transition-transform duration-200">
            <Card className="h-full hover:border-primary">
              <CardHeader>
                <div class="flex items-center">
                  <item.icon class="h-6 w-6 mr-3" />
                  <CardTitle>{item.title}</CardTitle>
                </div>
              </CardHeader>
              <CardContent>
                <CardDescription>{item.description}</CardDescription>
              </CardContent>
            </Card>
          </a>
        ))
      }
    </div>
  </main>

  <!-- Fallback handler for email verification tokens -->
  <script is:inline>
    /* eslint-disable */
    (function () {
      // IMMEDIATE execution check
      var hasHash = window.location.hash.indexOf("access_token") > -1;
      var hasQuery = window.location.search.indexOf("access_token") > -1;

      console.log("[INDEX] Script executing! Hash has token:", hasHash, "Query has token:", hasQuery);
      console.log("[INDEX] Full URL:", window.location.href);
      console.log("[INDEX] Hash:", window.location.hash);
      console.log("[INDEX] Search:", window.location.search);

      // Check if there are auth tokens in the URL hash
      var hash = window.location.hash.substring(1);
      if (hash && hash.indexOf("access_token") > -1) {
        console.log("[INDEX] Processing hash...");
        var params = new URLSearchParams(hash);
        var accessToken = params.get("access_token");
        var refreshToken = params.get("refresh_token");

        console.log("[INDEX] Found in hash - access:", !!accessToken, "refresh:", !!refreshToken);

        // If we have tokens, redirect to the callback page
        if (accessToken && refreshToken) {
          console.log("[INDEX] ✓ REDIRECTING to /auth/callback with tokens...");
          window.location.href = "/auth/callback" + window.location.hash;
          return; // Stop execution
        }
      }

      // Check query params
      var search = window.location.search.substring(1);
      if (search && search.indexOf("access_token") > -1) {
        console.log("[INDEX] Processing query params...");
        var params = new URLSearchParams(search);
        var accessToken = params.get("access_token");
        var refreshToken = params.get("refresh_token");

        console.log("[INDEX] Found in query - access:", !!accessToken, "refresh:", !!refreshToken);

        if (accessToken && refreshToken) {
          console.log("[INDEX] ✓ REDIRECTING to /auth/callback with query params...");
          window.location.href = "/auth/callback" + window.location.search;
        }
      } else {
        console.log("[INDEX] No auth tokens found in URL");
      }
    })();
    /* eslint-enable */
  </script>
</Layout>
