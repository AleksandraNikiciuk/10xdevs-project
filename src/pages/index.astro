---
import Layout from "../layouts/Layout.astro";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "../components/ui/card";
import { Zap, Layers, PenSquare, Sparkles, BookOpen, Target } from "lucide-react";

const navItems = [
  {
    href: "/generate",
    title: "Generate with AI",
    description: "Automatically create flashcards from your text using AI.",
    icon: Zap,
  },
  {
    href: "/flashcards",
    title: "Browse Flashcards",
    description: "View, edit, and manage all your created flashcards.",
    icon: Layers,
  },
  {
    href: "/manual-create",
    title: "Create Manually",
    description: "Add new flashcards one by one with your own content.",
    icon: PenSquare,
  },
];

const tipItems = [
  {
    title: "Quick Tips",
    description: "Use AI generation to quickly create flashcards from your notes, articles, or study materials.",
    icon: Sparkles,
  },
  {
    title: "Study Smart",
    description: "Organize your flashcards by topic and review them regularly for better retention.",
    icon: BookOpen,
  },
  {
    title: "Stay Consistent",
    description: "Daily practice with flashcards improves memory and accelerates learning.",
    icon: Target,
  },
];
---

<Layout title="Dashboard">
  <main class="container mx-auto px-4 py-8">
    <header class="text-center mb-12">
      <h1
        class="text-4xl font-bold tracking-tight bg-gradient-to-r from-md-primary via-md-tertiary to-md-primary bg-clip-text text-transparent"
      >
        Flashcard Dashboard
      </h1>
      <p class="text-lg text-muted-foreground mt-2">Choose an option to get started</p>
    </header>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {
        navItems.map((item) => (
          <a href={item.href} class="block group hover:scale-105 transition-all duration-200">
            <Card className="h-full hover:border-primary hover:shadow-[0_0_8px_rgba(120,119,198,0.2)] transition-all duration-300">
              <CardHeader>
                <div class="flex items-center gap-4">
                  <item.icon class="h-6 w-6 text-md-primary group-hover:text-md-tertiary transition-colors duration-200" />
                  <CardTitle>{item.title}</CardTitle>
                </div>
              </CardHeader>
              <CardContent>
                <CardDescription>{item.description}</CardDescription>
              </CardContent>
            </Card>
          </a>
        ))
      }
    </div>
  </main>

  <!-- Dashboard Tips Section - placed before footer -->
  <section slot="before-footer" class="py-8 border-t border-md-outline-variant/50">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-5xl mx-auto">
        {
          tipItems.map((tip) => (
            <div class="flex gap-3 opacity-60">
              <tip.icon class="h-5 w-5 text-md-on-surface-variant flex-shrink-0 mt-0.5" />
              <div>
                <h3 class="text-body-large font-medium text-md-on-surface-variant mb-1">{tip.title}</h3>
                <p class="text-body-small text-md-on-surface-variant leading-relaxed">{tip.description}</p>
              </div>
            </div>
          ))
        }
      </div>
    </div>
  </section>

  <!-- Fallback handler for email verification tokens -->
  <script is:inline>
    /* eslint-disable */
    (function () {
      // IMMEDIATE execution check
      var hasHash = window.location.hash.indexOf("access_token") > -1;
      var hasQuery = window.location.search.indexOf("access_token") > -1;

      console.log("[INDEX] Script executing! Hash has token:", hasHash, "Query has token:", hasQuery);
      console.log("[INDEX] Full URL:", window.location.href);
      console.log("[INDEX] Hash:", window.location.hash);
      console.log("[INDEX] Search:", window.location.search);

      // Check if there are auth tokens in the URL hash
      var hash = window.location.hash.substring(1);
      if (hash && hash.indexOf("access_token") > -1) {
        console.log("[INDEX] Processing hash...");
        var params = new URLSearchParams(hash);
        var accessToken = params.get("access_token");
        var refreshToken = params.get("refresh_token");

        console.log("[INDEX] Found in hash - access:", !!accessToken, "refresh:", !!refreshToken);

        // If we have tokens, redirect to the callback page
        if (accessToken && refreshToken) {
          console.log("[INDEX] ✓ REDIRECTING to /auth/callback with tokens...");
          window.location.href = "/auth/callback" + window.location.hash;
          return; // Stop execution
        }
      }

      // Check query params
      var search = window.location.search.substring(1);
      if (search && search.indexOf("access_token") > -1) {
        console.log("[INDEX] Processing query params...");
        var params = new URLSearchParams(search);
        var accessToken = params.get("access_token");
        var refreshToken = params.get("refresh_token");

        console.log("[INDEX] Found in query - access:", !!accessToken, "refresh:", !!refreshToken);

        if (accessToken && refreshToken) {
          console.log("[INDEX] ✓ REDIRECTING to /auth/callback with query params...");
          window.location.href = "/auth/callback" + window.location.search;
        }
      } else {
        console.log("[INDEX] No auth tokens found in URL");
      }
    })();
    /* eslint-enable */
  </script>
</Layout>
