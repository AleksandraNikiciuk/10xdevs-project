---
import Layout from "../layouts/Layout.astro";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "../components/ui/card";
import { Zap, List, PenSquare } from "lucide-react";
import { ThemeToggle } from "../components/ui/theme-toggle";

const navItems = [
  {
    href: "/generate",
    title: "Generate with AI",
    description: "Automatically create flashcards from your text using AI.",
    icon: Zap,
  },
  {
    href: "/flashcards",
    title: "Browse Flashcards",
    description: "View, edit, and manage all your created flashcards.",
    icon: List,
  },
  {
    href: "/manual-create",
    title: "Create Manually",
    description: "Add new flashcards one by one with your own content.",
    icon: PenSquare,
  },
];
---

<Layout title="Dashboard">
  <main class="container mx-auto px-4 py-8">
    <header class="flex justify-between items-center mb-12">
      <div class="flex-1"></div>
      <div class="flex-1 text-center">
        <h1 class="text-4xl font-bold tracking-tight">Flashcard Dashboard</h1>
        <p class="text-lg text-muted-foreground mt-2">Choose an option to get started</p>
      </div>
      <div class="flex-1 flex justify-end">
        <ThemeToggle client:load />
      </div>
    </header>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {
        navItems.map((item) => (
          <a href={item.href} class="block hover:scale-105 transition-transform duration-200">
            <Card className="h-full hover:border-primary">
              <CardHeader>
                <div class="flex items-center">
                  <item.icon class="h-6 w-6 mr-3" />
                  <CardTitle>{item.title}</CardTitle>
                </div>
              </CardHeader>
              <CardContent>
                <CardDescription>{item.description}</CardDescription>
              </CardContent>
            </Card>
          </a>
        ))
      }
    </div>
  </main>

  <!-- Fallback handler for email verification tokens -->
  <script is:inline>
    /* eslint-disable */
    (function () {
      console.log("[INDEX] Checking for auth tokens...");
      console.log("[INDEX] Full URL:", window.location.href);
      console.log("[INDEX] Hash:", window.location.hash);
      console.log("[INDEX] Search:", window.location.search);
      
      // Check if there are auth tokens in the URL hash
      const hash = window.location.hash.substring(1);
      if (hash) {
        const params = new URLSearchParams(hash);
        const accessToken = params.get("access_token");
        const refreshToken = params.get("refresh_token");

        console.log("[INDEX] Found in hash - access:", !!accessToken, "refresh:", !!refreshToken);

        // If we have tokens, redirect to the callback page
        if (accessToken && refreshToken) {
          console.log("[INDEX] Redirecting to /auth/callback with tokens...");
          window.location.href = "/auth/callback" + window.location.hash;
        }
      } else {
        console.log("[INDEX] No hash in URL, checking query params...");
        const search = window.location.search.substring(1);
        if (search) {
          const params = new URLSearchParams(search);
          const accessToken = params.get("access_token");
          const refreshToken = params.get("refresh_token");
          
          console.log("[INDEX] Found in query - access:", !!accessToken, "refresh:", !!refreshToken);
          
          if (accessToken && refreshToken) {
            console.log("[INDEX] Redirecting to /auth/callback with query params...");
            window.location.href = "/auth/callback" + window.location.search;
          }
        }
      }
    })();
    /* eslint-enable */
  </script>
</Layout>
